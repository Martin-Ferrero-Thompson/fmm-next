// scripts/generate-build-info.mjs
// Generates src/build-info.ts with the current package version and build timestamp (ISO-8601 UTC)
import { readFileSync, writeFileSync, mkdirSync } from 'node:fs';
import { dirname, resolve } from 'node:path';
import { fileURLToPath } from 'node:url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const root = resolve(__dirname, '..');
const srcDir = resolve(root, 'src');

const pkgPath = resolve(root, 'package.json');
const pkg = JSON.parse(readFileSync(pkgPath, 'utf8'));

const builtAt = new Date().toISOString();

const outPath = resolve(srcDir, 'build-info.ts');
const banner = `// Auto-generated by scripts/generate-build-info.mjs. Do not edit manually.\n`;
const content = `${banner}export const version = ${JSON.stringify(pkg.version)};\nexport const builtAt = ${JSON.stringify(builtAt)};\n`;

mkdirSync(srcDir, { recursive: true });
writeFileSync(outPath, content, 'utf8');

console.log(`Generated ${outPath} -> version=${pkg.version}, builtAt=${builtAt}`);
